{% extends "quiz/base.html" %}
{% load i18n %}
{% load form_tags %}

{% block title %}Set New Password - Pro Prelims{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-7 col-lg-5">
      <div class="card shadow-sm" style="border-radius: 1rem;">
        <div class="card-header text-white py-3 px-4" style="background: var(--primary-gradient); border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
          <h5 class="mb-0 d-flex align-items-center">
            <i class="fa fa-lock me-2"></i> Set New Password
          </h5>
        </div>
        <div class="card-body px-4 py-4">

          {% if token_fail %}
            <div class="alert alert-danger mb-4">
              The password reset link is invalid or has expired.
            </div>
            <a href="{% url 'account_reset_password' %}" class="btn btn-primary w-100">
              <i class="fa fa-redo me-2"></i>Request New Link
            </a>
          {% else %}
            {% if form.non_field_errors %}
              <div class="alert alert-danger small">
                {% for error in form.non_field_errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}

            <p class="text-muted small mb-4">Create a new password that you haven't used before. Keep it safe.</p>

            <form method="POST" novalidate>
              {% csrf_token %}

              <div class="mb-3">
                {{ form.password1.label_tag }}
                {{ form.password1|add_class:"form-control form-control-sm" }}
                {% for error in form.password1.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>

              <div class="mb-3">
                {{ form.password2.label_tag }}
                {{ form.password2|add_class:"form-control form-control-sm" }}
                {% for error in form.password2.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>

              <button type="submit" class="mt-3 btn btn-accent-yellow w-100 fw-semibold">
                <i class="fa fa-check me-2"></i>Set Password
              </button>
            </form>
          {% endif %}

          <div class="text-center mt-4">
            <a href="{% url 'account_login' %}" class="text-muted small text-decoration-none">
              <i class="fa fa-arrow-left me-1"></i>Back to Login
            </a>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
