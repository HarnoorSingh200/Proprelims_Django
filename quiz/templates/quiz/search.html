{% extends 'quiz/base.html' %}
{% block title %}Browse Quizzes - Pro Prelims{% endblock %}

{% block content %}
<style>
  /* Custom styles to match border-radius of search bar and button */
  .search-form .form-control,
  .search-form .btn-primary {
    border-radius: 8px; /* Consistent border-radius for both elements */
  }

  /* Optional: Adjust button padding for better icon alignment */
  .search-form .btn-primary {
    padding: 0; /* Remove default padding to center icon */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Ensure the icon size is balanced */
  .search-form .btn-primary i {
    font-size: 1.25rem; /* Slightly larger icon for visibility */
  }

  /* Quiz card styles from home.html */
  .quiz-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border-radius: 0.75rem;
    background: #fff;
  }

  .quiz-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
  }

  .quiz-card .card-title {
    font-size: 1.1rem;
    min-height: 3rem; /* Ensures even height for titles */
  }

  .quiz-card .badge {
    font-size: 0.75rem;
    padding: 0.35em 0.6em;
  }

  /* Add mobile-specific adjustments for quiz cards */
  @media (max-width: 576px) {
    .search-form .form-control,
    .search-form .btn-primary {
      border-radius: 6px; /* Smaller radius for smaller screens */
    }

    .quiz-card .card-body {
      padding: 1rem; /* Reduce padding */
    }
    .quiz-card .card-title {
      min-height: 2rem; /* Reduce min-height */
      font-size: 1rem; /* Smaller font for mobile */
      margin-bottom: 0.5rem; /* Reduce margin */
    }
    .quiz-card .mb-3 {
      margin-bottom: 0.5rem !important; /* Reduce margin */
    }
    .quiz-card .mt-auto {
      margin-top: 0.5rem !important; /* Reduce gap */
    }
  }
</style>

<div class="mb-5">
  <h3 class="mb-4 mt-1 text-center fw-bold">
    <i class="fa fa-search me-2"></i>
    {% if quiz_type == 'super' %}
      Search Mock Tests
    {% elif quiz_type == 'advance' %}
      Search Sectional Tests
    {% else %}
      Search Quizzes
    {% endif %}
  </h3>

  <!-- Search Bar -->
  <form method="GET" action="{% url 'quiz_search_page' %}" class="mb-4 search-form">
    <input type="hidden" name="quiz_type" value="{{ quiz_type }}"> <!-- Add quiz_type -->
    <div class="row justify-content-center g-2">
      <div class="col-9 col-sm-6 col-md-6">
        <input type="text" name="q" class="form-control h-100" placeholder="Search quizzes by topic" value="{{ query }}">
      </div>
      <div class="col-3 col-sm-2 col-md-2">
        <button type="submit" class="btn btn-primary w-100 h-100 d-flex align-items-center justify-content-center">
          <i class="fa fa-search"></i>
        </button>
      </div>
    </div>
  </form>

  <!-- Filter Tags -->
  <div class="mb-4 d-flex flex-wrap gap-2 justify-content-center">
    <a href="{% url 'quiz_search_page' %}?quiz_type={{ quiz_type }}" class="btn btn-outline-secondary btn-sm {% if not tag %}active{% endif %}">All</a>
    {% for t in tags %}
      <a href="{% url 'quiz_search_page' %}?quiz_type={{ quiz_type }}&tag={{ t|urlencode }}" class="btn btn-outline-secondary btn-sm {% if tag == t %}active{% endif %}">
        {{ t }}
      </a>
    {% endfor %}
  </div>

  <!-- Quiz List -->
  <div class="row">
    {% for quiz in page_obj %}
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card quiz-card h-100 border-0 shadow-sm">
          <div class="card-body d-flex flex-column">
            <!-- Title -->
            <h5 class="card-title fw-semibold text-black mb-2">
              {{ quiz.quiz_name }}
            </h5>

            <!-- Question count -->
            <p class="small text-muted mb-2">
              {% if quiz_type == 'super' %}
                {{ quiz.total_questions }} Questions | {{ quiz.total_questions }} min
              {% else %}
                {{ quiz.question_count }} Questions | {{ quiz.question_count }} min
              {% endif %}
            </p>

            <!-- Tags -->
            <div class="mb-3">
              {% for tag in quiz.exam_tags %}
                <span class="badge bg-light text-dark border me-1 mb-1">{{ tag }}</span>
              {% endfor %}
              {% if quiz.has_attempted %}
                <span class="badge bg-success ms-2"><i class="fas fa-check"></i></span>
              {% endif %}
            </div>

            <!-- Action Button -->
            <div class="mt-auto">
              {% if quiz.requires_signup %}
                {% if user.is_authenticated %}
                  <a href="{% if quiz_type == 'super' %}{% url 'super_quiz_paginated' quiz.quiz_id %}
                            {% elif quiz_type == 'advance' %}{% url 'advance_quiz_paginated' quiz.quiz_id %}
                            {% else %}{% url 'quiz_paginated' quiz.quiz_id %}{% endif %}"
                     class="btn btn-primary w-100">Start Quiz</a>
                {% else %}
                  <a href="{% url 'account_login' %}" class="btn btn-outline-primary w-100">Login to Start</a>
                {% endif %}
              {% else %}
                <a href="{% if quiz_type == 'super' %}{% url 'super_quiz_paginated' quiz.quiz_id %}
                          {% elif quiz_type == 'advance' %}{% url 'advance_quiz_paginated' quiz.quiz_id %}
                          {% else %}{% url 'quiz_paginated' quiz.quiz_id %}{% endif %}"
                   class="btn btn-primary w-100">Start Quiz</a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-warning text-center">No quizzes found.</div>
      </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
    <nav class="mt-4">
      <ul class="pagination justify-content-center flex-wrap">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?quiz_type={{ quiz_type }}{% if query %}&q={{ query }}{% endif %}{% if tag %}&tag={{ tag }}{% endif %}&page={{ page_obj.previous_page_number }}">Previous</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?quiz_type={{ quiz_type }}{% if query %}&q={{ query }}{% endif %}{% if tag %}&tag={{ tag }}{% endif %}&page={{ page_obj.next_page_number }}">Next</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}